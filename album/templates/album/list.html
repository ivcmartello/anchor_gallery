{% extends 'base.html' %} 
{% load tag_extras %}
{% load thumbnail %}
{% block body %}

<div class="row">
  {% for photo in page_obj %}
    <div class="col-lg-3 col-md-4 col-xs-6 p-1"> 
      <div class="card md-4 box-shadow">
        <div class="text-center p-2">
          <a href="{% url 'photo:detail' photo.uuid %}">
            {% thumbnail photo.image "300x200" crop="center" as im %}
                <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" class="img-thumbnail">
            {% endthumbnail %}
          </a>
        </div>
        <div class="card-body">
          <p class="card-text">{{ photo.submitter }}</p>
          <div class="btn-group">
            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="like('{{ photo.uuid }}');"><spam id="s-like-{{ photo.uuid }}">{{ photo.like_count }}</spam> <i class="fas fa-heart ml-1" {% is_liked request photo.uuid as is_liked %}{% if is_liked %}style="color:red;"{% else %}style="color:grey;"{% endif %}name="like-{{ photo.uuid }}"></i>  Like</button>
          </div>
          <small class="text-muted">
						{{ photo.created_at }}
					</small>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

{% if page_obj.paginator.num_pages > 1 %}
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center p-2">
        {% if page_obj.paginator.num_pages != 1 %}
            <li class="page-item"><a class="page-link" href="?page=1">First</a></li>
        {% else %}
            <li class="page-item disabled"><a class="page-link" href="#">First</a></li>
        {% endif %}
        {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo;</a></li>
        {% else %}
            <li class="page-item disabled"><a class="page-link" href="#">&laquo;</a></li>
        {% endif %}
        {% for i in page_obj.paginator.page_range %}
            {% if page_obj.number == i %}
                <li class="page-item active"><a class="page-link" href="#">{{ i }} <span class="sr-only">(current)</span></a></li>
            {% elif page_obj.number > i|add:"-5" and page_obj.number < i|add:"+5"%}
                <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
            {% endif %}
        {% endfor %}
        {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a></li>
        {% else %}
            <li class="page-item disabled"><a class="page-link" href="#">&raquo;</a></li>
        {% endif %}
        {% if page_obj.paginator.num_pages != page_obj.number %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last</a></li>
        {% else %}
            <li class="page-item disabled"><a class="page-link" href="#">Last</a></li>
        {% endif %}
    </ul>
  </nav>
{% endif %}

<script>
  function like(photo_uuid){
    like_btn = $("[name=like-"+photo_uuid+"]");
    s_like_btn = $("[id=s-like-"+photo_uuid+"]");
    $.ajax({
      url:"http://"+document.location.hostname+":8000/api/like_photo",
      type:'GET',
      data:{
        "photo_uuid":photo_uuid
      },
      dataType: 'json',
      success: function(data){
        if (data.liked) {
          like_btn.attr('style', 'color:grey;');
        }
        else {
          like_btn.attr('style', 'color:red;');
        }
        s_like_btn.text(data.like_count);
      }
    });
  };

</script>

{% endblock body %}